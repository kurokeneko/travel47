<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>47éƒ½é“åºœçœŒåˆ¶è¦‡ãƒãƒƒãƒ—ï¼ˆSVGç‰ˆ ã²ãªå‹ï¼‰</title>
<meta name="theme-color" content="#43a047" />
<link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:%2247%E9%83%BD%E9%81%93%E5%BA%9C%E7%9C%8C%E5%88%B6%E8%A6%87%E3%83%9E%E3%83%83%E3%83%97%22,%22short_name%22:%22%E5%88%B6%E8%A6%87%E3%83%9E%E3%83%83%E3%83%97%22,%22display%22:%22standalone%22,%22start_url%22:%22.%22,%22background_color%22:%22#ffffff%22,%22theme_color%22:%22#43a047%22,%22icons%22:[]}" />
<style>
  :root{
    --green:#43a047; --green-ink:#2e7d32; --bg:#f7faf7; --chip:#e8f5e9;
    --ink:#222; --muted:#687076; --visited:#81c784; --highlight:#ffecb3; --unvisited:#e0e0e0;
    --stroke:#c7c7c7;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
  header{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid #eee;padding:12px 16px;display:flex;align-items:center;gap:12px}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--green)}
  h1{font-size:18px;margin:0;color:var(--green-ink)}
  .wrap{max-width:1000px;margin:0 auto;padding:16px}
  .panel{background:#fff;border:1px solid #eee;border-radius:12px;padding:12px}
  .stats{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 4px}
  .chip{background:var(--chip);border:1px solid #dbe7dc;color:var(--green-ink);padding:6px 10px;border-radius:999px;font-weight:600}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  button{appearance:none;border:0;border-radius:10px;padding:10px 14px;background:var(--green);color:#fff;font-weight:700;letter-spacing:.02em}
  button.ghost{background:#fff;color:var(--green-ink);border:1px solid #c8e6c9}
  button:disabled{opacity:.55}
  .hint{color:var(--muted);font-size:13px}
  .mapShell{background:#fff;border:1px solid #eee;border-radius:12px;padding:8px}
  svg{width:100%;height:auto;max-width:900px;display:block;margin:0 auto}
  .pref{cursor:pointer;fill:var(--unvisited);stroke:var(--stroke);stroke-width:0.8}
  .pref.visited{fill:var(--visited)}
  .pref.selected{filter:drop-shadow(0 0 0.6rem rgba(255,200,0,.6))}
  .label{font-size:9px;fill:#333;pointer-events:none}
  .legend{display:flex;gap:8px;align-items:center;margin-top:8px;color:#333;flex-wrap:wrap}
  .swatch{width:14px;height:14px;border-radius:4px;border:1px solid #ddd}
  .list{margin-top:12px;font-size:14px}
  .badge{display:inline-block;background:#fff3cd;color:#8a6d3b;border:1px solid #ffe8a1;border-radius:999px;padding:2px 8px;font-size:12px}
  footer{color:var(--muted);font-size:12px;text-align:center;margin:24px 0}
</style>
</head>
<body>
<header><span class="dot"></span><h1>47éƒ½é“åºœçœŒåˆ¶è¦‡ãƒãƒƒãƒ—ï¼ˆç²¾å¯†SVGã²ãªå‹ï¼‰</h1></header>

<div class="wrap">
  <div class="panel">
    <div class="stats" id="stats">
      <span class="chip">è¨ªå•æ¸ˆã¿ <b id="visitedCount">0</b> / 47</span>
      <span class="chip">ãƒã‚¤ãƒ³ãƒˆ <b id="points">0</b> pt</span>
      <span class="chip">ãƒ•ãƒªãƒ¼ãƒã‚±ãƒƒãƒˆ <b id="tickets">0</b> æš</span>
    </div>
    <div class="row">
      <button id="drawLots">ğŸ¯ ãã˜ã‚’å¼•ãï¼ˆæœªè¨ªå•ã‹ã‚‰ï¼‰</button>
      <button id="useTicket" class="ghost" disabled>ğŸŸ ãƒ•ãƒªãƒ¼ãƒã‚±ãƒƒãƒˆã‚’ä½¿ã†</button>
      <button id="reset" class="ghost">åˆæœŸåŒ–</button>
    </div>
    <p class="hint">SVGå†…ã®çœŒï¼ˆå½¢ãã®ã‚‚ã®ï¼‰ã‚’ã‚¿ãƒƒãƒ—ã§è¨ªå•æ¸ˆã¿ã«ã€‚10çœŒã”ã¨ã«ğŸŸ1æšã€‚ğŸŸä½¿ç”¨ä¸­ã¯æ—¢è¨ªå•ã‚‚ã€Œç‰¹åˆ¥è¨ªå•ã€è¨˜éŒ²å¯èƒ½ã€‚</p>
  </div>

  <div class="mapShell" aria-label="æ—¥æœ¬åœ°å›³ï¼ˆç²¾å¯†SVGï¼‰">
    <!-- â–¼â–¼â–¼ ã“ã“ãŒâ€œç½®ãæ›ãˆãƒã‚¤ãƒ³ãƒˆâ€ â–¼â–¼â–¼
         ä»Šã¯ã‚µãƒ³ãƒ—ãƒ«ï¼ˆåŒ—æµ·é“ãƒ»é’æ£®ãƒ»å²©æ‰‹ã®ã¿ï¼‰ã§ã™ã€‚
         å¾Œè¿°æ‰‹é †ã«å¾“ã„ã€ã“ã“å…¨ä½“ã‚’ã€Œ47éƒ½é“åºœçœŒã®ç²¾å¯†SVGã€ã«ä¸¸ã”ã¨ç½®æ›ã—ã¦ãã ã•ã„ã€‚ -->
    <svg id="japanMap" viewBox="120 0 860 900" xmlns="http://www.w3.org/2000/svg" aria-label="Japan Map (sample)">
      <!-- åŒ—æµ·é“ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã®å˜ç´”åŒ–ãƒ‘ã‚¹ï¼‰ -->
      <path id="pref-hokkaido" class="pref" data-name="åŒ—æµ·é“"
            d="M570,60 l60,20 40,40 -30,30 -40,15 -30,-10 -35,-30 -15,-35 20,-20 z" />
      <!-- é’æ£® -->
      <path id="pref-aomori" class="pref" data-name="é’æ£®"
            d="M520,200 l40,10 10,30 -25,20 -35,-10 -10,-25 20,-25 z" />
      <!-- å²©æ‰‹ -->
      <path id="pref-iwate" class="pref" data-name="å²©æ‰‹"
            d="M520,270 l50,10 5,60 -35,40 -35,-10 -5,-40 20,-60 z" />
      <!-- â€»ä»¥é™ã®çœŒã¯ç½®æ›æ™‚ã«å…¨ã¦å…¥ã‚Šã¾ã™ -->

      <!-- ä»®ãƒ©ãƒ™ãƒ«ï¼ˆç½®æ›æ™‚ã¯è‡ªå‹•ã§å‰Šé™¤OKï¼‰ -->
      <text x="585" y="70" class="label">åŒ—æµ·é“</text>
      <text x="535" y="220" class="label">é’æ£®</text>
      <text x="540" y="310" class="label">å²©æ‰‹</text>
    </svg>
    <!-- â–²â–²â–² ç½®ãæ›ãˆãƒã‚¤ãƒ³ãƒˆï¼ˆSVGå…¨éƒ¨ï¼‰ â–²â–²â–² -->

    <div class="legend">
      <span class="swatch" style="background:var(--unvisited)"></span> æœªè¨ªå•
      <span class="swatch" style="background:var(--visited)"></span> è¨ªå•æ¸ˆã¿
      <span class="swatch" style="outline:3px solid var(--highlight);background:#fff"></span> ãã˜å½“é¸/ç‰¹åˆ¥é¸æŠä¸­
    </div>
    <div class="list" id="logArea"></div>
  </div>

  <footer>SVGã¯å¾Œã§47çœŒç‰ˆã«ç½®æ›ã§ãã¾ã™ï¼UIãƒ»ãƒã‚¤ãƒ³ãƒˆãƒ»ãã˜ã¯ã“ã®ã¾ã¾ä½¿ãˆã¾ã™</footer>
</div>

<script>
/* ===== ã‚¢ãƒ—ãƒªã®å…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆSVGå·®ã—æ›¿ãˆå¾Œã‚‚ãã®ã¾ã¾ä½¿ãˆã¾ã™ï¼‰ ===== */
const PREFS = [
  "åŒ—æµ·é“","é’æ£®","å²©æ‰‹","å®®åŸ","ç§‹ç”°","å±±å½¢","ç¦å³¶",
  "èŒ¨åŸ","æ ƒæœ¨","ç¾¤é¦¬","åŸ¼ç‰","åƒè‘‰","æ±äº¬","ç¥å¥ˆå·",
  "æ–°æ½Ÿ","å¯Œå±±","çŸ³å·","ç¦äº•","å±±æ¢¨","é•·é‡","å²é˜œ","é™å²¡","æ„›çŸ¥",
  "ä¸‰é‡","æ»‹è³€","äº¬éƒ½","å¤§é˜ª","å…µåº«","å¥ˆè‰¯","å’Œæ­Œå±±",
  "é³¥å–","å³¶æ ¹","å²¡å±±","åºƒå³¶","å±±å£",
  "å¾³å³¶","é¦™å·","æ„›åª›","é«˜çŸ¥",
  "ç¦å²¡","ä½è³€","é•·å´","ç†Šæœ¬","å¤§åˆ†","å®®å´","é¹¿å…å³¶","æ²–ç¸„"
];

const state = { visited:{}, specialTrips:[], usedTickets:0, selected:null, ticketMode:false };

const els = {
  visitedCount:document.getElementById("visitedCount"),
  points:document.getElementById("points"),
  tickets:document.getElementById("tickets"),
  drawLots:document.getElementById("drawLots"),
  useTicket:document.getElementById("useTicket"),
  reset:document.getElementById("reset"),
  logArea:document.getElementById("logArea"),
  svg:document.getElementById("japanMap")
};

init();

function init(){
  // ä¿å­˜å¾©å…ƒ
  const saved = JSON.parse(localStorage.getItem("jp47-game")||"{}");
  if(saved.visited) state.visited = saved.visited;
  if(saved.specialTrips) state.specialTrips = saved.specialTrips;
  if(saved.usedTickets!=null) state.usedTickets = saved.usedTickets;

  // SVGå†…ã®å…¨ã¦ã®çœŒãƒ‘ã‚¹ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»˜ä¸ï¼ˆdata-nameå±æ€§ã§çœŒåã‚’ä¸€è‡´ã•ã›ã‚‹ï¼‰
  bindSvgEvents();

  // UIã‚¤ãƒ™ãƒ³ãƒˆ
  els.drawLots.addEventListener("click", onDrawLots);
  els.useTicket.addEventListener("click", onToggleTicketMode);
  els.reset.addEventListener("click", hardReset);

  // PWAï¼ˆç°¡æ˜“SWï¼‰
  if('serviceWorker' in navigator){
    const sw = `self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>self.clients.claim());self.addEventListener('fetch',e=>{});`;
    const url = URL.createObjectURL(new Blob([sw],{type:'text/javascript'}));
    navigator.serviceWorker.register(url);
  }

  updateStats();
}

function bindSvgEvents(){
  if(!els.svg) return;
  const paths = els.svg.querySelectorAll('.pref');
  paths.forEach(p=>{
    const name = p.dataset.name;
    if(state.visited[name]) p.classList.add('visited');
    p.addEventListener('click', ()=>onPrefClick(p));
  });
}

function onPrefClick(el){
  const name = el.dataset.name;
  if(!name) return;

  if(state.ticketMode){
    if(getTickets()<=0){ alert("ãƒ•ãƒªãƒ¼ãƒã‚±ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“"); state.ticketMode=false; renderTicketButton(); return; }
    state.specialTrips.push({name, ts:Date.now()});
    state.usedTickets += 1; state.ticketMode=false; renderTicketButton(); flash(el);
    save(); renderLog(); updateStats(); return;
  }
  if(!state.visited[name]){
    state.visited[name] = true; el.classList.add("visited"); flash(el);
    save(); renderLog(); updateStats();
  } else {
    wiggle(el);
  }
}

function onDrawLots(){
  const unvisited = PREFS.filter(n=>!state.visited[n]);
  if(unvisited.length===0){ alert("æœªè¨ªå•ã®çœŒã¯ã‚ã‚Šã¾ã›ã‚“ï¼åˆ¶è¦‡ãŠã‚ã§ã¨ã†ï¼"); return; }
  const pick = unvisited[Math.floor(Math.random()*unvisited.length)];
  state.selected = pick;
  document.querySelectorAll(".pref").forEach(p=>{
    p.classList.toggle("selected", p.dataset.name===pick);
  });
  const el = [...document.querySelectorAll(".pref")].find(p=>p.dataset.name===pick);
  if(el) flash(el);
}

function onToggleTicketMode(){
  if(getTickets()<=0 && !state.ticketMode){ alert("ãƒ•ãƒªãƒ¼ãƒã‚±ãƒƒãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚10çœŒé”æˆã§1æšä»˜ä¸ã€‚"); return; }
  state.ticketMode = !state.ticketMode; renderTicketButton();
  document.querySelectorAll(".pref").forEach(p=>{
    p.classList.toggle("selected", state.ticketMode || p.dataset.name===state.selected);
  });
}

function getVisitedCount(){ return Object.values(state.visited).filter(Boolean).length; }
function getTickets(){ const issued = Math.floor(getVisitedCount()/10); return issued - state.usedTickets; }

function updateStats(){
  const visited = getVisitedCount();
  els.visitedCount.textContent = visited;
  els.points.textContent = visited;
  els.tickets.textContent = getTickets();
  renderTicketButton(); renderLog();
}
function renderTicketButton(){
  els.useTicket.disabled = getTickets()<=0 && !state.ticketMode;
  els.useTicket.textContent = state.ticketMode ? "âœ… ä½¿ã†ã®ã‚’ã‚„ã‚ã‚‹" : "ğŸŸ ãƒ•ãƒªãƒ¼ãƒã‚±ãƒƒãƒˆã‚’ä½¿ã†";
}
function renderLog(){
  const t = getTickets(), used = state.usedTickets, issued = Math.floor(getVisitedCount()/10);
  const logs = [];
  logs.push(`ğŸ“ ãƒ­ã‚°ï¼šç™ºè¡Œ <span class="badge">${issued}æš</span> ï¼ ä½¿ç”¨ <span class="badge">${used}æš</span> ï¼ æ®‹ <span class="badge">${t}æš</span>`);
  if(state.specialTrips.length){
    const items = state.specialTrips.slice().reverse().slice(0,10).map(s=>{
      const d = new Date(s.ts);
      const ds = `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
      return `ãƒ»${ds} ç‰¹åˆ¥è¨ªå•ï¼š${s.name}`;
    }).join("<br>");
    logs.push(items);
  } else { logs.push(`ãƒ»ã¾ã ç‰¹åˆ¥è¨ªå•ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆ10çœŒé”æˆã§ğŸŸ1æšï¼‰`); }
  els.logArea.innerHTML = logs.join("<br>");
}
function save(){
  localStorage.setItem("jp47-game", JSON.stringify({
    visited:state.visited, specialTrips:state.specialTrips, usedTickets:state.usedTickets
  }));
}
function hardReset(){
  if(!confirm("ã™ã¹ã¦ã®è¨˜éŒ²ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
  state.visited = {}; state.specialTrips = []; state.usedTickets = 0; state.selected = null; state.ticketMode = false;
  document.querySelectorAll(".pref").forEach(p=>p.classList.remove("visited","selected"));
  save(); updateStats();
}
function flash(el){ el.animate([{transform:"scale(1)"},{transform:"scale(1.06)"},{transform:"scale(1)"}],{duration:280,easing:"ease-out"}); }
function wiggle(el){ el.animate([{transform:"translateX(0)"},{transform:"translateX(-3px)"},{transform:"translateX(3px)"},{transform:"translateX(0)"}],{duration:280,easing:"ease-out"}); }
</script>
</body>
</html>





